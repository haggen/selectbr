/*
 * SelectBr v0.1 2012-08-22 18:24:32 -0300
 * by Arthur Corenzan <arthur@corenzan.com>
 * licensed under http://creativecommons.org/licenses/by/3.0
 * more on http://haggen.github.com/selectbr
 */
(function(c){var d;d=function(a,b){this.state={field:c(a)};this.city={};this.jsonPath=b||"/brazil.json";this.findCityField();this.replaceFieldsBySelect();this.buildStateOptions();this.bindEvents()};d.cache=null;d.prototype={findCityField:function(){var a=this.state.field.attr("data-brazil-state");this.city.field=c('input[data-brazil-city="'+a+'"]')},replaceFieldsBySelect:function(){var a,b=["class","style","name","id"];this.state.select=c("<select></select>");this.city.select=c("<select></select>");
for(a in b)b.hasOwnProperty(a)&&(this.state.select.attr(b[a],this.state.field.attr(b[a])),this.city.select.attr(b[a],this.city.field.attr(b[a])));this.state.field.after(this.state.select).remove();this.city.field.after(this.city.select).remove()},buildStateOptions:function(){var a=this;this.getJsonData(function(b){a.state.select.html("<option></option>"+c.map(b.Brasil,function(a,b){return'<option value="'+b+'">'+b+"</option>"}).join(""));a.state.select.val(a.state.field.val());a.state.select.trigger("change")})},
bindEvents:function(){var a=this;this.state.select.on("change",function(){var b=this;a.getJsonData(function(d){a.city.select.html("<option></option>"+c.map(d.Brasil[b.value],function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""));a.city.select.val(a.city.field.val())})})},getJsonData:function(a){null!==d.cache?a(d.cache):c.getJSON(this.jsonPath,function(b){d.cache=b;a(b)})}};c.selectbr=function(a){c("input[data-brazil-state]").each(function(){new d(this,a)})}})(window.jQuery);
